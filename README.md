
# Estudo de Microsservices para Venda de Ingressos - CineTicket

<!-- 
    Logo image generated by Bing IA: https://www.bing.com/images/create/
    Font file by dafont: https://www.dafont.com/pt/cinema-st.font?text=CineTicket&psize=l
-->
<img 
  src="./docs/images/header.png" 
/>

<img src="./docs/images/icons/nginx.svg" width="25px" height="25px" title="Nginx" alt="Nginx"> <img src="./docs/images/icons/nodedotjs.svg" width="25px" height="25px" title="Node.js" alt="Node.js"> <img src="./docs/images/icons/npm.svg" width="25px" height="25px" alt="npm" title="npm"> <img src="./docs/images/icons/express.svg" width="25px" height="25px" title="Express" alt="Express"> <img src="./docs/images/icons/docker.svg" width="25px" height="25px" alt="Docker" title="Docker"> <img src="./docs/images/icons/github.svg" width="25px" height="25px" alt="GitHub" title="GitHub"> <img src="./docs/images/icons/nx.svg" width="25px" height="25px" alt="NX" title="NX"> <img src="./docs/images/icons/visualstudiocode.svg" width="25px" height="25px" alt="vscode" title="vscode"> <img src="./docs/images/icons/bootstrap.svg" width="25px" height="25px" alt="bootstrap" title="bootstrap"> <img src="./docs/images/icons/jquery.svg" width="25px" height="25px" alt="jquery" title="jquery"> <!-- icons by https://simpleicons.org/?q=types -->

![Badge Status](https://img.shields.io/badge/STATUS-EM_DESENVOLVIMENTO-green)


 [![Miro](https://img.shields.io/badge/VISIT%20OUR-MIRO-050038?style=for-the-badge&logo=MIRO&logoColor=white)](https://miro.com/app/board/uXjVNRofMoA=/) [![Youtube](https://img.shields.io/badge/API%20Event%20storming%20PTBR-Youtube-FF0000?style=for-the-badge&logo=youtube&logoColor=white)](https://www.youtube.com/watch?v=6nEbm71Vc3w) [![Github Project](https://img.shields.io/badge/PROJECT%20VIEW-GITHUB-181717?style=for-the-badge&logo=github&logoColor=white)](https://github.com/users/jtonynet/projects/2)


<br/>

#### üï∏Ô∏è Minhas Redes:
[![linkedin](https://img.shields.io/badge/Linkedin-0A66C2?style=for-the-badge&logo=linkedin&logoColor=white)](https://www.linkedin.com/in/jos%C3%A9-r-99896a39/) [![dev.to](https://img.shields.io/badge/dev.to-0A0A0A?style=for-the-badge&logo=devdotto&logoColor=white)](https://dev.to/learningenuity) [![gmail](https://img.shields.io/badge/Gmail-D14836?style=for-the-badge&logo=gmail&logoColor=white)](mailto:learningenuity@gmail.com) [![Twitter](https://img.shields.io/badge/Twitter-1DA1F2?style=for-the-badge&logo=twitter&logoColor=white)](https://twitter.com/aromademirtilo) [![instagram](https://img.shields.io/badge/Instagram-E4405F?style=for-the-badge&logo=instagram&logoColor=white)](https://www.instagram.com/learningenuity) 


---

<a id="indice"></a>
## :arrow_heading_up: √çndice
<!--ts-->

- [Estudo de Microsservices para Venda de Ingressos - CineTicket](#estudo-de-microsservices-para-venda-de-ingressos---cineticket)
  :arrow_heading_up: [√çndice](#arrow_heading_up-√≠ndice)<br/>
  :green_book: [Sobre](#green_book-sobre)<br/>
  :camera: [Imagens](#camera-imagens)<br/>
  :computer: [Instala√ß√£o](#computer-instala√ß√£o)<br/>
  :bar_chart: [Diagramas](#bar_chart-diagramas)<br/>
  :hammer: [Ferramentas](#hammer-ferramentas)<br/>
  :clap: [Boas Pr√°ticas](#clap-boas-pr√°ticas)<br/>
  :nerd_face: [Para Desenvolvedores](#nerd_face-para-desenvolvedores)<br/>
  :1234: [Vers√µes](#1234-vers√µes)<br/>
  :robot: [Uso de IA](#ia)

<!--te-->
---
<a id="sobre"></a>
## :green_book: Sobre

Monorepo para estudo de arquitetura de venda de ingressos similar ao video ["Como fazer o ingressos.x escalar?"](https://www.youtube.com/watch?v=0TMr8rsmU-k)

N√£o busco as melhores solu√ß√µes nem o cen√°rio perfeito (tudo sempre tem trade-offs). Pretendo resolver quest√µes espec√≠ficas e criar "APIs Mock" para servi√ßos, com o objetivo de validar hip√≥teses e aos poucos escalar para algo totalmente funcional.

Isso √© um laborat√≥rio de utiliza√ß√£o de servi√ßos para solucionar os dois principais problemas propostos pelo video:
1. Como escalar uma funcionalidade que possui um gargalo do lado do principal fornecedor (a API de reserva de tickets).
2. Criar uma "antesala" que impe√ßa um "flood" de requisi√ß√µes semelhante a um ataque DDoS.

Al√©m dos mencionados, trabalhar com consist√™ncia eventual e implementar um conjunto de "rollbacks" de reserva caso ocorram falhas no pagamento ou na reserva (nas APIs externas "mock"). Tentar evoluir a solu√ß√£o para algo semelhante ao padr√£o de saga.

Devo criar o projeto aumentando aos poucos seu escopo do zero ao deploy.

Foi utilizado o [template bootstrap gratuito FlixGo](https://www.templateshub.net/template/FlixGo-Online-Movies-Template), algumas altera√ß√µes ser√£o necess√°rias, pois o mesmo foi elaborado tendo sistemas de streaming em mente. A princ√≠pio, usando JavaScript puro para chamadas de API, aos poucos sendo alteradas para componentes React, aproveitando a versatilidade do gerenciador de monorepos Nx.

Pretendo construir os servi√ßos do sistema distribu√≠do em Node.js e Go e utilizar [Architecture decision record (ADR)](https://github.com/joelparkerhenderson/architecture-decision-record) para justificar as tomadas de decis√£o.

[:arrow_heading_up: voltar](#indice)

---

<a id="imagens"></a>
## :camera: Imagens
Projeto rodando local
<img src="./docs/images/project.png" alt="Projeto rodando local" title="Projeto rodando local"> 

<br>

[:arrow_heading_up: voltar](#indice)

---

<a id="instalacao"></a>
## :computer: Instala√ß√£o

Para executar o projeto, siga as instru√ß√µes abaixo:

1. Fa√ßa o download/clone do reposit√≥rio do projeto.
2. Certifique-se de ter o Docker Compose instalado em sua m√°quina.
3. Execute na raiz do projeto, o comando `docker-compose up` ou `docker compose up`, dependendo da vers√£o do Docker Compose instalada.
4. Acesse `http://localhost:8080` em seu navegador para visualizar o projeto.

[:arrow_heading_up: voltar](#indice)

---

<a id="diagrama"></a>
## :bar_chart: Diagramas

O diagrama abaixo ilustra a uma **proposta** de arquitetura para o projeto:

```mermaid
graph LR

subgraph USER FLOW
  A([Web Client]) -->|HTTP| B(front-site catalog view)
  A -->|HTTP| D(front-site authentication)
  D -->|HTTP| C(front-site purchase)
end

subgraph BACKEND
  subgraph API
    B -->|HTTP| E[catalog-service]
    C -->|HTTP| N[orchestration-service]
    N -->|GRPC| F[checkout-service]
    N -->|GRPC| L[ticket-reservation-service]
    D <-->|HTTP| O[authorization-service]
  end
  
  subgraph DATABASE
    H[(catalog-service DB)] <-->| | E
    K[(checkout-service DB)] <-->| | F
    P[(authorization-service DB)] <-->| | O
    Q[(ticket-reservation-service DB)] <-->| | L
  end
  
  subgraph CACHE
    E <-->| | R[redis-catalog-cache]
  end

  subgraph MOCK-EXTERNAL-APIs
    F -->|HTTP| G[mock-payment-gateway-x-service]
    L -->|HTTP| M[mock-provider-x-reservation-slow-service]
  end
end
``` 

<br>
<details>
<summary>O fluxo de intera√ß√µes para o usu√°rio comprar um assento de um filme que esteja sendo exibido, com base no diagrama fornecido, √© o seguinte:</summary>
<br/>
<ol>
  <li>
    Acesso √† visualiza√ß√£o do cine-ticket-front-site: O usu√°rio pode acessar a interface de visualiza√ß√£o do cine-ticket-front-site (representado pela seta "Cliente Web" -> "cine-ticket-front-site visualizacao").
  </li>
  <li>
    Autentica√ß√£o no cine-ticket-front-site: O usu√°rio pode realizar o processo de autentica√ß√£o no cine-ticket-front-site (representado pela seta "Cliente Web" -> "cine-ticket-front-site autenticacao" -> "cine-ticket-user-auth-api").
  </li>
  <li>
    Compra no cine-ticket-front-site: Ap√≥s a autentica√ß√£o, o usu√°rio pode prosseguir com a compra no cine-ticket-front-site (representado pela seta "Cliente Web" -> "cine-ticket-front-site compra" -> "cine-ticket-orchestration-api" -> "cine-ticket-checkout-api" -> "mock-gateway-pagamento-api" e "cine-ticket-confirma-reserva" -> "mock-parceiro-reserva-lento-api").
  </li>
</ol>
<br>
  Dessa forma, o fluxo completo de intera√ß√µes envolve o cliente web interagindo com as APIs de exibi√ß√£o, autentica√ß√£o. As APIs de checkout e reserva devem ser orquestradas por uma outra API ainda a definir, respons√°vel pelo processo de roolback em caso de falhas.
</details>
<br/>

[:arrow_heading_up: voltar](#indice)

---

<a id="ferramentas"></a>
## :hammer: Ferramentas
As seguintes ferramentas foram usadas na constru√ß√£o do projeto:

- [Node.js](https://nodejs.org/en/)
- [Express](https://expressjs.com/en/)
- [TypeScript](https://www.typescriptlang.org/)
- [npm](https://www.npmjs.com/)
- [Nx](https://nx.dev/)
- [Docker](https://www.docker.com/)

[:arrow_heading_up: voltar](#indice)

---

<a id="boas-praticas"></a>
## :clap: Boas Pr√°ticas
Seguindo boas pr√°ticas de desenvolvimento:
- [Semantic Versioning 2.0.0](https://semver.org/spec/v2.0.0.html)
- [keep a changelog](https://keepachangelog.com/en/1.0.0/)
- [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/)
- [Mermaid Diagrams](https://mermaid.js.org)
- [Monorepo](https://monorepo.tools/)
- [Architecture decision record (ADR)](https://github.com/joelparkerhenderson/architecture-decision-record)

[:arrow_heading_up: voltar](#indice)

---
<a id="desenvolvedores"></a>
## :nerd_face: Para Desenvolvedores
Nada do que for discutido nessa se√ß√£o deve atrapalhar o [correto funcionamento e instala√ß√£o](#computer-instala√ß√£o) do projeto em uma m√°quina com o docker-compose funcional

Durante o estudo/desenvolvimento, foram adotadas as ferramentas [Nx](https://nx.dev/) (que requer Nodejs em sua m√°quina) e seu [console no VScode](https://marketplace.visualstudio.com/items?itemName=nrwl.angular-console) para a gest√£o de Monorepos. Para uma experi√™ncia de desenvolvimento e valida√ß√£o t√©cnica do reposit√≥rio, [sugiro instala√ß√£o do ambiente de gerenciamento](https://docs.npmjs.com/downloading-and-installing-node-js-and-npm). Explicar o funcionamento do Nx n√£o √© o objetivo do presente documento (at√© mesmo porque tamb√©m estou aprendendo), mas [encorajo a buscar esses dados](https://nx.dev/getting-started/intro) caso deseje. [Qualquer Monorepo pode se tornar um monorepo Nx](https://blog.nrwl.io/adding-nx-to-an-existing-monorepo-by-running-one-command-426fa519d943).

Tenha bons estudos :)
<!-- `npx nx dep-graph` √© MARAVILHOSO -->
[:arrow_heading_up: voltar](#indice)

---

<a id="versionamento"></a>
## :1234: Vers√µes
Para obter mais informa√ß√µes, consulte o [Hist√≥rico de Vers√µes](./CHANGELOG.md).

[:arrow_heading_up: voltar](#indice)

---

<a id="ia"></a>
### :robot: Uso de IA:

O cabe√ßalho desta p√°gina foi criado com a fonte [cinema-st](https://www.dafont.com/pt/cinema-st.font?text=CineTicket&psize=l) e o aux√≠lio de intelig√™ncia artificial e um m√≠nimo de 
retoque e constru√ß√£o no Gimp [<img src="./docs/images/icons/gimp.svg" width="30" height="30" title="Gimp" alt="Logo do Gimp" />](https://www.gimp.org/)


__Foram utilizados os seguintes prompts para sua cria√ß√£o no [Bing IA:](https://www.bing.com/images/create/)__


<details>
  <summary><b>Ingresso de cinema com rolo de filme</b></summary>
<i>"logotipo para um site de venda de ingressos de cinema estilo cartoon simplificado chamado cineticket, UM ingresso de cinema Azul com detalhes vermelhos rodeado por um negativo de rolo de filme de cinema com fundo branco"<b>(sic)</b></i>
</details>

<br/>


IA tamb√©m √© utilizada em minhas pesquisas e estudos como ferramenta de apoio; no entanto, __artes e desenvolvimento s√£o, sobretudo, atividades criativas humanas.__

Contrate artistas para projetos comerciais ou mais elaborados e Aprenda Engenhosidade!

[:arrow_heading_up: voltar](#indice)
